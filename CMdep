# Specify the minimum CMake version.
cmake_minimum_required(VERSION 3.10)

# Set the project's name and description.
project(ManySnakes
	VERSION 0.0.12.2
	DESCRIPTION "\"ManySnakes by Danielle Raine.\""
	HOMEPAGE_URL "\"https://github.com/DanielleRaine/ManySnakes\""
	LANGUAGES C
)

# Specify C standard.
set(CMAKE_C_STANDARD 99)
set(CMAKE_C_STANDARD_REQUIRED True)

# Set compile warnings.
add_compile_options(-Wall -Wextra -Wpedantic)

# Find included packages.
find_package(SDL2 REQUIRED)
find_package(SDL2_image REQUIRED)
find_package(SDL2_ttf REQUIRED)
find_package(Lua REQUIRED)

# Set the config file's constants to pass project directories and descriptions.
configure_file(src/config.h.in config.h)

# Set the output directory for executables.
set(EXECUTABLE_OUTPUT_PATH ${CMAKE_BINARY_DIR}/ManySnakes)

# Add executable called ManySnakes, built from source files.
add_executable(ManySnakes
	src/main.c
	src/math.c
	src/snake.c
	src/texture.c
)

# Specify location to look for configured header files.
target_include_directories(ManySnakes PRIVATE
	"${PROJECT_BINARY_DIR}"
)

# Link the libraries to the project.
target_link_libraries(ManySnakes SDL2::SDL2 SDL2_image::SDL2_image SDL2_ttf::SDL2_ttf)

# Ensure creation of output directory.
file(MAKE_DIRECTORY ${EXECUTABLE_OUTPUT_PATH})

# Define the source and destination directories.
set(ASSETS_SOURCE_DIR "${CMAKE_BINARY_DIR}/assets")
set(ASSETS_DESTINATION_DIR "${EXECUTABLE_OUTPUT_PATH}/assets")

# Create the destination directory if it doesn't exist.
file(MAKE_DIRECTORY "${ASSETS_DESTINATION_DIR}")

# Create command to copy the assets.
add_custom_command(
	OUTPUT "${ASSETS_DESTINATION_DIR}/placeholder.txt"
	COMMAND ${CMAKE_COMMAND} -E copy_if_different "${ASSETS_SOURCE_DIR}" "${ASSETS_DESTINATION_DIR}"
	DEPENDS
	COMMENT "Copying assets to build directory."
	VERBATIM
)

# Define the custom target that depends on the command
    add_custom_target(copy_assets ALL
        DEPENDS "${ASSETS_DESTINATION_DIR}/placeholder.txt"
    )

    # Ensure that the executable target depends on the copy_assets target
    add_dependencies(ManySnakes copy_assets)
